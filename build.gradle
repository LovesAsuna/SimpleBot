plugins {
    id 'java'
    id 'com.github.johnrengelman.shadow' version '6.1.0'
    id 'org.jetbrains.kotlin.jvm' version '1.5.30'
    id "org.jetbrains.kotlin.plugin.serialization" version "1.5.30"
}

description('一个基于Mirai的机器人')
group 'com.hyosakura'
version '4.1.0'

ext {
    workDir = 'E:\\work\\Mirai-Console\\plugins'
    mirai_version = '2.7.0'
    kotlin_version = '1.5.21'
}

sourceCompatibility = 11
targetCompatibility = 11

repositories {
    mavenCentral()
}

defaultTasks("shadowJar")

// mirai
dependencies {
    compileOnly "net.mamoe:mirai-console:$mirai_version"
    compileOnly "net.mamoe:mirai-core:$mirai_version"
    testImplementation "net.mamoe:mirai-console:$mirai_version"
    testImplementation "net.mamoe:mirai-core:$mirai_version"
}

// kotlin
dependencies {
    compileOnly 'org.jetbrains.kotlinx:kotlinx-coroutines-core:1.5.2-native-mt'
    implementation "org.jetbrains.kotlin:kotlin-stdlib:$kotlin_version"
    implementation "org.jetbrains.kotlin:kotlin-stdlib-jdk8:$kotlin_version"
    implementation "org.jetbrains.kotlin:kotlin-stdlib-jdk7:$kotlin_version"
    implementation "org.jetbrains.kotlin:kotlin-reflect:$kotlin_version"
}

dependencies {
    implementation 'org.jsoup:jsoup:1.14.2'
    implementation 'com.fasterxml.jackson.module:jackson-module-kotlin:2.12.5'
    implementation 'com.h2database:h2:1.4.200'
    implementation 'org.hibernate.orm:hibernate-core:6.0.0.Alpha8'
    implementation 'com.charleskorn.kaml:kaml:0.35.3'
    implementation 'com.github.oshi:oshi-core:5.8.2'
    implementation 'net.java.dev.jna:jna:5.9.0'
    implementation 'net.java.dev.jna:jna-platform:5.9.0'
    implementation 'com.squareup.okhttp3:okhttp:4.9.1'
    implementation 'com.github.theholywaffle:teamspeak3-api:1.3.0'
    testImplementation 'org.junit.jupiter:junit-jupiter:5.7.2'

}

compileKotlin {
    kotlinOptions {
        jvmTarget = "1.8"
    }
    kotlinOptions.useIR = true
}

test {
    useJUnitPlatform()
}

compileJava {
    options.encoding = 'UTF-8'
    options.compilerArgs.add('-Xlint:deprecation')
    options.compilerArgs.add('-Xlint:unchecked')
}

task copyFile(type: Copy, dependsOn: shadowJar) {
    duplicatesStrategy = DuplicatesStrategy.INCLUDE
    from('build/libs/')
    into(workDir)
    include('Mirai-Bot*.jar')
    rename {
        "Bot.jar"
    }
}

compileTestKotlin {
    kotlinOptions {
        jvmTarget = "1.8"
    }
}

